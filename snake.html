<!DOCTYPE html>
<html lang="it">
<head>
  <title>Snake Didattico - Tecnologia</title>
  <meta charset="UTF-8">
  <style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Verdana', sans-serif;
  }

  body {
    background: #2c3e50;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
  }

  h1 { margin-bottom: 10px; font-size: 24px; }
  
  #game-container {
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }

  canvas {
    border: 4px solid #ecf0f1;
    background: black;
    display: block;
  }

  /* Stile per il pannello del Quiz */
  #quiz-overlay {
    display: none; /* Nascosto di default */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(44, 62, 80, 0.95);
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
  }

  .btn-risposta {
    background: #e67e22;
    color: white;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    cursor: pointer;
    font-size: 14px;
    width: 80%;
    border-radius: 5px;
    transition: background 0.3s;
  }

  .btn-risposta:hover { background: #d35400; }

  #punteggio-box {
    margin-top: 10px;
    font-size: 18px;
  }
  </style>
</head>
<body>

<h1>Strutture Portanti Snake üêç</h1>

<div id="game-container">
    <canvas width="400" height="400" id="game"></canvas>
    
    <div id="quiz-overlay">
        <h2 id="titolo-quiz">Game Over!</h2>
        <p id="testo-domanda">Domanda...</p>
        <div id="opzioni-container"></div>
        <p id="feedback" style="font-weight:bold; margin-top:10px;"></p>
        <button id="btn-rigioca" style="display:none; margin-top:15px; padding:10px; background:#27ae60; color:white; border:none; cursor:pointer;" onclick="resetGame()">Gioca di nuovo</button>
    </div>
</div>

<div id="punteggio-box">Punti: <span id="score">0</span></div>

<script>
// --- CONFIGURAZIONE DATABASE DOMANDE (TECNOLOGIA) ---
const databaseDomande = [
    {
        domanda: "Nel TRILITE, come si chiama l'elemento orizzontale appoggiato sui piedritti?",
        opzioni: ["Colonna", "Architrave", "Capitello"],
        corretta: 1 // Indice della risposta corretta (0, 1, 2)
    },
    {
        domanda: "Qual √® l'elemento fondamentale che 'chiude' un ARCO e scarica le forze?",
        opzioni: ["Chiave di volta", "Concio basale", "Piedritto"],
        corretta: 0
    },
    {
        domanda: "Nella CAPRIATA, quale elemento lavora a trazione impedendo al tetto di aprirsi?",
        opzioni: ["Puntone", "Monaco", "Catena"],
        corretta: 2
    },
    {
        domanda: "Nel CEMENTO ARMATO, qual √® la funzione delle barre di acciaio?",
        opzioni: ["Resistere alla compressione", "Resistere alla trazione", "Abbellire la struttura"],
        corretta: 1
    },
    {
        domanda: "Quale struttura √® composta da travi e pilastri solidali tra loro?",
        opzioni: ["Telaio", "Arco a tutto sesto", "Isostatica"],
        corretta: 0
    },
    {
        domanda: "La forza che tende a schiacciare un materiale si chiama:",
        opzioni: ["Trazione", "Compressione", "Torsione"],
        corretta: 1
    }
];

// --- VARIABILI DI GIOCO ---
var canvas = document.getElementById('game');
var context = canvas.getContext('2d');

// Dimensione della griglia (16px) e contatore per rallentare il gioco
var grid = 16;
var count = 0;
var score = 0;
var isGameOver = false;

var snake = {
  x: 160,
  y: 160,
  
  // Velocit√† del serpente. Si muove di una lunghezza griglia per ogni frame
  dx: grid,
  dy: 0,
  
  // Tiene traccia di tutte le celle occupate dal corpo del serpente
  cells: [],
  
  // Lunghezza del serpente. Cresce mangiando la mela (o il regalo)
  maxCells: 4
};

var apple = {
  x: 320,
  y: 320
};

// Genera numeri interi casuali in un intervallo specifico
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

// --- CICLO PRINCIPALE DEL GIOCO (GAME LOOP) ---
function loop() {
  // Se √® game over, fermiamo il ciclo di animazione
  if(isGameOver) return;

  requestAnimationFrame(loop);

  // Rallenta il ciclo di gioco a 15 fps invece di 60 (60/4 = 15)
  // Questa √® la parte che gestisce la VELOCIT√Ä
  if (++count < 4) {
    return;
  }

  count = 0;
  context.clearRect(0,0,canvas.width,canvas.height);

  // Muove il serpente in base alla sua velocit√† attuale
  snake.x += snake.dx;
  snake.y += snake.dy;

  // --- LOGICA DEI CONFINI (EFFETTO PAC-MAN) ---
  // Se esce a sinistra, riappare a destra
  if (snake.x < 0) {
    snake.x = canvas.width - grid;
  }
  // Se esce a destra, riappare a sinistra
  else if (snake.x >= canvas.width) {
    snake.x = 0;
  }
  
  // Se esce sopra, riappare sotto
  if (snake.y < 0) {
    snake.y = canvas.height - grid;
  }
  // Se esce sotto, riappare sopra
  else if (snake.y >= canvas.height) {
    snake.y = 0;
  }

  // Tiene traccia di dove √® stato il serpente. L'inizio dell'array √® sempre la testa
  snake.cells.unshift({x: snake.x, y: snake.y});

  // Rimuove le celle man mano che ci allontaniamo (la coda si accorcia muovendosi)
  if (snake.cells.length > snake.maxCells) {
    snake.cells.pop();
  }

  // Disegna la mela (o regalo)
  context.fillStyle = '#e74c3c'; // Rosso
  context.fillRect(apple.x, apple.y, grid-1, grid-1);

  // Disegna il serpente una cella alla volta
  context.fillStyle = '#2ecc71'; // Verde
  snake.cells.forEach(function(cell, index) {
    
    // Disegniamo 1 px pi√π piccolo della griglia per creare un effetto "tessere"
    context.fillRect(cell.x, cell.y, grid-1, grid-1);  

    // Il serpente ha mangiato la mela
    if (cell.x === apple.x && cell.y === apple.y) {
      snake.maxCells++;
      score += 10; // Punti per aver mangiato
      document.getElementById('score').innerText = score;

      // Il canvas √® 400x400 che corrisponde a 25x25 celle
      apple.x = getRandomInt(0, 25) * grid;
      apple.y = getRandomInt(0, 25) * grid;
    }

    // Controllo collisione con tutte le celle successive (se tocca se stesso)
    for (var i = index + 1; i < snake.cells.length; i++) {
      
      // Il serpente occupa lo stesso spazio di una parte del corpo. RESET GIOCO.
      if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
        triggerGameOver(); // Invece di resettare subito, lanciamo il quiz
      }
    }
  });
}

// --- GESTIONE INPUT TASTIERA ---
document.addEventListener('keydown', function(e) {
  // Previene che il serpente torni indietro su se stesso controllando
  // che non stia gi√† muovendo sull'asse opposto

  // Freccia Sinistra (37)
  if (e.which === 37 && snake.dx === 0) {
    snake.dx = -grid;
    snake.dy = 0;
  }
  // Freccia Su (38)
  else if (e.which === 38 && snake.dy === 0) {
    snake.dy = -grid;
    snake.dx = 0;
  }
  // Freccia Destra (39)
  else if (e.which === 39 && snake.dx === 0) {
    snake.dx = grid;
    snake.dy = 0;
  }
  // Freccia Gi√π (40)
  else if (e.which === 40 && snake.dy === 0) {
    snake.dy = grid;
    snake.dx = 0;
  }
});

// --- FUNZIONI QUIZ E GAME OVER ---

function triggerGameOver() {
    isGameOver = true;
    
    // Pesca una domanda casuale
    const indiceRandom = Math.floor(Math.random() * databaseDomande.length);
    const domandaScelta = databaseDomande[indiceRandom];

    // Mostra Overlay
    const overlay = document.getElementById('quiz-overlay');
    const titolo = document.getElementById('titolo-quiz');
    const testo = document.getElementById('testo-domanda');
    const containerOpzioni = document.getElementById('opzioni-container');
    const feedback = document.getElementById('feedback');
    const btnRigioca = document.getElementById('btn-rigioca');

    overlay.style.display = 'flex';
    titolo.innerText = "Schianto! Rispondi per salvarti i punti";
    testo.innerText = domandaScelta.domanda;
    
    // Pulisce opzioni vecchie e resetta stato
    containerOpzioni.innerHTML = '';
    feedback.innerText = '';
    btnRigioca.style.display = 'none';

    // Crea i bottoni per le risposte
    domandaScelta.opzioni.forEach((opzione, index) => {
        let btn = document.createElement('button');
        btn.innerText = opzione;
        btn.className = 'btn-risposta';
        btn.onclick = function() {
            controllaRisposta(index, domandaScelta.corretta, containerOpzioni);
        };
        containerOpzioni.appendChild(btn);
    });
}

function controllaRisposta(indiceScelto, indiceCorretto, container) {
    const feedback = document.getElementById('feedback');
    const btnRigioca = document.getElementById('btn-rigioca');
    
    // Disabilita tutti i bottoni dopo il click
    let bottoni = container.querySelectorAll('button');
    bottoni.forEach(b => b.disabled = true);

    if(indiceScelto === indiceCorretto) {
        feedback.style.color = '#2ecc71';
        feedback.innerText = "RISPOSTA ESATTA! +50 Punti Bonus";
        score += 50;
        document.getElementById('score').innerText = score;
    } else {
        feedback.style.color = '#e74c3c';
        feedback.innerText = "SBAGLIATO! La risposta corretta era: " + bottoni[indiceCorretto].innerText;
    }
    
    // Mostra il tasto per ricominciare
    btnRigioca.style.display = 'inline-block';
}

function resetGame() {
    // Nascondi overlay
    document.getElementById('quiz-overlay').style.display = 'none';
    
    // Resetta variabili Snake
    snake.x = 160;
    snake.y = 160;
    snake.cells = [];
    snake.maxCells = 4;
    snake.dx = grid;
    snake.dy = 0;
    
    // Resetta mela
    apple.x = getRandomInt(0, 25) * grid;
    apple.y = getRandomInt(0, 25) * grid;

    // Resetta punteggio
    score = 0;
    document.getElementById('score').innerText = score;

    // Riavvia Loop
    isGameOver = false;
    requestAnimationFrame(loop);
}

// Avvia il gioco la prima volta
requestAnimationFrame(loop);
</script>
</body>
</html>
</html>
